<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Teleoperated Robot Hand: Code/RobotHandTransmitter Directory Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Teleoperated Robot Hand
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('dir_2ad1e6abcf0888cd3d5675dc34495cd9.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">RobotHandTransmitter Directory Reference</div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-subdirs" class="groupheader"><a id="subdirs" name="subdirs"></a>
Directories</h2></td></tr>
<tr class="memitem:src" id="r_src"><td class="memItemLeft" align="right" valign="top"><span class="iconfolder"><div class="folder-icon"></div></span>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dir_de2951422398a00ab7645ad0bee61e87.html">src</a></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<h1 class="doxsection"><a class="anchor" id="autotoc_md2"></a>
Robot Hand Transmitter</h1>
<p>This folder holds the platform.io project for the transmitter. The main task of this project is to read the bend of the glove and transmit the data to the receiver.</p>
<p>In order to mimic the user's hand motions while wearing the glove, we used flex sensors that act like potentiometers. Depending on how much the user is bending the flex sensor, the resistance will increase or decrease. By creating a simple voltage divider circuit with the flex sensor and a 100 ohm resistor, we can read how the voltage is changing through ADC channels on our ESP-32.</p>
<p><img src="https://github.com/user-attachments/assets/309f3436-5216-49cf-a61c-420ee75bec58" alt="image" width="578" height="149" class="inline"/></p>
<p>Delving into the software, we can see the basic task architecure above. There are only 2 tasks for this project with the read sensors task running every 10ms and then sending that data over to the transmit task to then be sent to the receiver.</p>
<p>Each finger has its own queue when communicating between tasks, but to make the code simpler a <a class="el" href="class_hand.html" title="Class holding FreeRTOS queues for all glove fingers and palm.">Hand</a> class was created. This <a class="el" href="class_hand.html" title="Class holding FreeRTOS queues for all glove fingers and palm.">Hand</a> class holds all the queues and is used as a way to access each queue from the tasks.</p>
<p>In the read sensors task, the voltage is read from each flex sensor and published to a queue. The transmit task is constantly reading from each queue until it is empty. An average is then taken while making sure to avoid dividng by zero.</p>
<div class="fragment"><div class="line">// Read from queue until empty and take average</div>
<div class="line">while(xQueueReceive(queue, &amp;reading, 0) == pdTRUE) {</div>
<div class="line">  sum += reading;</div>
<div class="line">  count++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">if (count &gt; 0) {</div>
<div class="line">  return (sum / count);</div>
<div class="line">} else {</div>
<div class="line">  return 0; // Don&#39;t want to divide by zero if nothing in queue</div>
<div class="line">}</div>
</div><!-- fragment --><p>Setup for ESP-NOW is all done in the setup function before the scheduler begins. To avoid broadcasting to any ESP-32s nearby, we broadcast specifically to the MAC address of the device we want</p>
<div class="fragment"><div class="line">// Register peer</div>
<div class="line">memcpy(peerInfo.peer_addr, BROADCAST_ADDRESS, 6);</div>
<div class="line">peerInfo.channel = 0;  </div>
<div class="line">peerInfo.encrypt = false;</div>
<div class="line"> </div>
<div class="line">// Add peer        </div>
<div class="line">if (esp_now_add_peer(&amp;peerInfo) != ESP_OK){</div>
<div class="line">  Serial.println(&quot;Failed to add peer&quot;);</div>
<div class="line">  return false;</div>
<div class="line">}</div>
</div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_23fdee2f6995db16c755697cdf620cf4.html">Code</a></li><li class="navelem"><a href="dir_2ad1e6abcf0888cd3d5675dc34495cd9.html">RobotHandTransmitter</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
